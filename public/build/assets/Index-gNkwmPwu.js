import{d as x,s as v,D as R,i as F,E as H,e as d,o as n,a as e,f as g,b as P,w as I,g as $,u as j,S as D,t as c,v as h,A as w,F as V,h as B,q,c as z,n as W,G as Z,B as J}from"./app-C0AWCbXp.js";import{C as G,r as K}from"./chart-DUfl3Dpl.js";import{_ as Q}from"./AppLayout-FFOYv3EV.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";G.register(...K);const X={class:"flex items-center justify-between mb-6"},Y={key:0,class:"mb-4 p-4 rounded border shadow",style:{"background-color":"var(--success-bg)",color:"var(--success-text)","border-color":"var(--success-border)"}},ee={class:"overflow-x-auto shadow rounded-lg",style:{"background-color":"var(--bg-color)",color:"var(--text-color)"}},te={class:"mb-4"},se={class:"flex flex-col sm:flex-row items-center justify-between mb-4 gap-4"},ae={class:"flex gap-2 items-center"},oe={class:"min-w-full divide-y divide-gray-200"},re={class:"divide-y divide-gray-200"},le={class:"px-6 py-4",style:{color:"var(--text-color)"}},ne={class:"px-6 py-4",style:{color:"var(--text-color)"}},de={class:"px-6 py-4",style:{color:"var(--text-color)"}},ce={class:"px-6 py-4",style:{color:"var(--text-color)"}},ie={class:"px-6 py-4",style:{color:"var(--text-color)"}},ue={class:"px-6 py-4",style:{color:"var(--text-color)"}},pe={class:"px-6 py-4 text-right space-x-2"},xe=["onSubmit"],fe={key:0,class:"text-center py-4",style:{color:"var(--text-muted)"}},be={key:1,class:"mt-4 flex justify-center space-x-2"},ve={class:"mt-10 p-4 rounded shadow w-full h-[400px]",style:{"background-color":"var(--bg-color)",color:"var(--text-color)"}},we=Object.assign({layout:Q},{__name:"Index",props:{entradas:Object},setup(N){const m=x(null),i=N,_=v(()=>{var s;const a={};for(const t of i.entradas.data){const o=((s=t.gestion)==null?void 0:s.nombre)||"Sin gestión";a[o]=(a[o]||0)+1}return{labels:Object.keys(a),data:Object.values(a)}}),C=R().props.flash,k=v(()=>C.success||C.message),f=x(""),r=x(""),l=x(""),u=x([]);function A(){u.value=i.entradas.data.filter(a=>{const s=new Date(a.fecha),t=r.value?new Date(r.value):null,o=l.value?new Date(l.value):null;return!(t&&s<t||o&&s>o)})}function M(){r.value="",l.value="",u.value=i.entradas.data}F(()=>{u.value=i.entradas.data}),F(()=>{if(!m.value)return;const a=m.value.getContext("2d");new G(a,{type:"bar",data:{labels:_.value.labels,datasets:[{label:"Entradas por Gestión",data:_.value.data,backgroundColor:"rgba(59, 130, 246, 0.5)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}})}),H(()=>i.entradas,a=>{u.value=a.data});const E=v(()=>{let a=u.value;const s=f.value.toLowerCase();return s?a.filter(t=>{var p,y,L,S;const o=((y=(p=t.user)==null?void 0:p.name)==null?void 0:y.toLowerCase())||"",b=((S=(L=t.tipoalerta)==null?void 0:L.descripcion)==null?void 0:S.toLowerCase())||"";return t.descripcion.toLowerCase().includes(s)||t.fecha.toLowerCase().includes(s)||t.hora.toLowerCase().includes(s)||o.includes(s)||b.includes(s)}):a});function T(a){confirm("¿Estás seguro de eliminar esta entrada?")&&J.delete(route("entrada.destroy",a),{preserveScroll:!0,preserveState:!1})}function U(){const a=new URLSearchParams;r.value&&a.append("inicio",r.value),l.value&&a.append("fin",l.value),window.open(route("entrada.export.excel")+"?"+a.toString(),"_blank")}const O=v(()=>!f.value&&!r.value&&!l.value);return(a,s)=>(n(),d("div",null,[e("div",X,[s[4]||(s[4]=e("h1",{class:"text-3xl font-bold",style:{color:"var(--text-color)"}},"Entradas",-1)),P(j(D),{href:a.route("entrada.create"),class:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded shadow"},{default:I(()=>s[3]||(s[3]=[$(" + Nueva entrada ")])),_:1},8,["href"])]),k.value?(n(),d("div",Y,c(k.value),1)):g("",!0),e("div",ee,[e("div",te,[h(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>f.value=t),type:"text",placeholder:"Buscar entrada...",class:"w-full sm:w-1/3 px-4 py-2 border border-gray-300 rounded shadow-sm focus:outline-none focus:ring focus:ring-blue-200"},null,512),[[w,f.value]])]),e("div",se,[e("div",ae,[h(e("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=t=>r.value=t),class:"border rounded px-3 py-2"},null,512),[[w,r.value]]),h(e("input",{type:"date","onUpdate:modelValue":s[2]||(s[2]=t=>l.value=t),class:"border rounded px-3 py-2"},null,512),[[w,l.value]]),e("button",{onClick:A,class:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-3 py-2 rounded shadow"}," Filtrar "),e("button",{onClick:M,class:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold px-3 py-2 rounded shadow"}," Limpiar ")]),e("div",{class:"flex gap-2"},[e("button",{onClick:U,class:"bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded shadow"}," Exportar Excel ")])]),e("table",oe,[s[6]||(s[6]=e("thead",{style:{"background-color":"var(--bg-secondary)"}},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Descripción"),e("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Fecha"),e("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Hora"),e("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Usuario"),e("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Gestión"),e("th",{class:"px-6 py-3 text-left text-sm font-semibold text-gray-700"},"Tipo de Alerta"),e("th",{class:"px-6 py-3 text-right text-sm font-semibold text-gray-700"},"Acciones")])],-1)),e("tbody",re,[(n(!0),d(V,null,B(E.value,t=>{var o,b,p;return n(),d("tr",{key:t.id},[e("td",le,c(t.descripcion),1),e("td",ne,c(t.fecha),1),e("td",de,c(t.hora),1),e("td",ce,c(((o=t.user)==null?void 0:o.name)||"—"),1),e("td",ie,c(((b=t.gestion)==null?void 0:b.nombre)||"—"),1),e("td",ue,c(((p=t.tipoalerta)==null?void 0:p.descripcion)||"—"),1),e("td",pe,[e("form",{onSubmit:q(y=>T(t.id),["prevent"]),class:"inline"},s[5]||(s[5]=[e("button",{type:"submit",class:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded shadow"}," Eliminar ",-1)]),40,xe)])])}),128))])]),E.value.length===0?(n(),d("div",fe," No se encontraron entradas. ")):g("",!0),O.value?(n(),d("div",be,[(n(!0),d(V,null,B(i.entradas.links,t=>(n(),z(Z(t.url?j(D):"span"),{key:t.label,href:t.url,class:W(["px-3 py-1 rounded border text-sm",{"bg-blue-600 text-white font-semibold":t.active,"bg-white text-gray-700 hover:bg-gray-100":!t.active,"cursor-not-allowed opacity-50":!t.url}]),innerHTML:t.label},null,8,["href","class","innerHTML"]))),128))])):g("",!0)]),e("div",ve,[s[7]||(s[7]=e("h2",{class:"text-xl font-semibold mb-4"},"Gráfico: Entradas por Gestión",-1)),e("canvas",{ref_key:"canvasRef",ref:m,class:"w-full h-full"},null,512)])]))}});export{we as default};
